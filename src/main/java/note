问题：
1. 异步消息发送失败,措施？只能将事务回滚掉


2. 扣减操作执行失败,这条消息该如何处理？


3. 下单失败无法正确回补库存,若用户取消支付，这时如何回补库存？
新建一个数据库表，用来存放库存流水状态



其实这些操作都是有问题的，因为我们没有一个对应的库存的操作记录，我们都无法知道当前的数据库的数据是否是正确的，
是因为异步消息没有到达 而没有正确的减1，  还是因为数据库的到底有没有减成功  我们都是没有办法知道的。
也就是说我们缺少一条记录，用来确定当前这个缓存库存的操作 当前是一个什么状态





发送事务型异步消息  同步扣减库存


排队有时候比并发更高效
依靠排队去限制并发流量
依靠排队和下游拥塞窗口程度调整队列释放流量大小

拥塞窗口为20的等待队列，用来消费下单请求(队列化泄洪),也就是说同一时刻只有20个线程执行下单请求，其他线程都要排队